mode: daemonset

image:
  repository: otel/opentelemetry-collector-k8s

presets:
  logsCollection:
    enabled: true
    includeCollectorLogs: true
  kubeletMetrics:
    enabled: true
  hostMetrics:
    enabled: true
  kubernetesAttributes:
    enabled: true

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

config:
  exporters:
    otlphttp:
      endpoint: {{ .Environment.Values.computed.clickstackOtelEndpoint | quote }}
      headers:
        authorization: {{ env "CLICKSTACK_INGESTION_KEY" | quote }}

  service:
    pipelines:
      logs:
        receivers: [otlp, filelog]
        processors: [memory_limiter, k8sattributes, batch]
        exporters: [otlphttp]
      metrics:
        receivers: [kubeletstats, hostmetrics]
        processors: [memory_limiter, k8sattributes, batch]
        exporters: [otlphttp]

clusterRole:
  create: true
